<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Test TreeWalker</title>
    <style>
        .cible {
            border: 1px solid red;
            padding: 5px;
        }
    </style>
</head>

<body>
    <h1>Test TreeWalker</h1>

    <!-- bruit : titres, paragraphes -->
    <p>Ceci est un paragraphe de test</p>
    <span>Span hors contexte</span>

    <!-- cible potentielle -->
    <div class="cible">
        <span id="42">Bonjour voiture</span>
        <span>Ignore moi voiture</span>
    </div>

    <!-- bruit : span mais pas dans la bonne div -->
    <div>
        <span>Pas intéressant</span>
    </div>

    <!-- bruit : span dans un bouton -->
    <div class="cible">
        <button>
            <span>Je dois être ignoré</span>
        </button>
    </div>

    <!-- autre cible -->
    <div class="cible">
        <span>Bonjour le monde</span>
    </div>
</body>

<script>
    console.log("ici");
    const root = document.body;
    var search = "voiture";
    var result = [];

    const walker = document.createTreeWalker(
        root,
        NodeFilter.SHOW_TEXT,
        {
            acceptNode: function (node) {
                console.log(node.textContent);
                const parent = node.parentElement;
                console.log(parent);
                if (parent != null) {
                    const tag = parent.nodeName.toLowerCase();
                    if (["script", "style", "noscript", "template"].includes(tag)) {
                        console.log("mon parent est un script");
                        return NodeFilter.FILTER_REJECT;
                    }
                };
                return NodeFilter.FILTER_ACCEPT;

            }
        }
    );

    let node;
    while (node = walker.nextNode()) {
        result.push((node.nodeValue || "").trim());
    }
    console.log(result);

</script>

</html>